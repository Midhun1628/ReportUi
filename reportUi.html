<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Report Layout Builder</title>
  <style>


    /* ← YOUR ORIGINAL STYLES ← */
   body { font-family: 'Segoe UI', sans-serif;
          margin: 0;
          display: flex;
          height: 100vh; }
          
   #sidebar {
  width: 260px;
  background: #34495e;
  color: white;
  padding: 20px;
  overflow-x: hidden;  /* <-- This hides horizontal scroll */
  overflow-y: auto;    /* <-- Still allows vertical scrolling */
  box-sizing: border-box;
}



    #sidebar h3 { 
    margin-top: 0; 
    font-size: 18px;
    border-bottom: 1px solid rgb(242 242 242 / 20%);
     }
    .draggable-label, button, select, input[type="color"] {
     width: 100%;
     padding: 10px; 
     margin: 6px 0;
     border: none;
     background: #2980b9;
     color: #fff;
     border-radius: 4px;
     cursor: pointer;

    }
    .draggable-label {
          background: #2c3f51;
          padding: 4px;
          margin-bottom: 10px;
          cursor: grab; 
          border-radius: 4px; }
    .draggable-label:hover, button:hover {
          background: #3498db; 
      }
    select, input[type="color"] { 
      background: #2c3e50; 
      color: #ecf0f1; 
    }
    .style-controls {
       margin: 12px 0;
       }
    .style-controls button { 
      width: 32%;
       display: inline-block;
        margin-right: 2%;
       }
    #canvasContainer { 
      flex: 1;
       overflow: auto;
        background: #e4e4e2;
         position: relative;
       }
#letterheadBackground {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  opacity: 0.5;
  pointer-events: none;
  z-index: 0;
  transition: background-image 0.3s ease;
}

/* Update canvas styles to ensure proper layering */
#canvas {
  position: relative;
  background: white; /* Changed from #f9f9f9 to transparent */
  margin: 100px;
  border: 1px solid #000;
}

.label-box {
  position: absolute;
  font-size: 14px;
  cursor: move;
  user-select: none;
  padding: 2px;
  background: rgba(255, 255, 255, 0.7); /* Semi-transparent white background */
  border: none;
  outline: none;
  min-width: 40px;
  z-index: 1; /* Ensure labels appear above the background */
}

/* Toggle Switch Styles */
.toggle-switch {
  display: flex;
  align-items: center;
  margin: 10px 0;
}

.toggle-switch input[type="checkbox"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 50px;
  height: 24px;
  background: #2c3e50;
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  outline: none;
  transition: background 0.3s;
  margin-right: 10px;
}

.toggle-switch input[type="checkbox"]:checked {
  background: #2980b9;
}

.toggle-switch input[type="checkbox"]::before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #ecf0f1;
  top: 2px;
  left: 2px;
  transition: transform 0.3s;
}

.toggle-switch input[type="checkbox"]:checked::before {
  transform: translateX(26px);
}

.toggle-switch label {
  color: white;
  cursor: pointer;
  user-select: none;
}
    
    .label-box.selected { background-color: rgba(76, 48, 186, 0.2); }
    .resizer { width: 8px; height: 8px; background: #2980b9; position: absolute; right: -4px; bottom: -4px; cursor: se-resize; border-radius: 2px; display: none; }
    #xGuide, #yGuide { position: absolute; background: rgba(231,76,60,0.6); z-index: 999; display: none; }
    #xGuide { height: 1px; width: 100%; }
    #yGuide { width: 1px; height: 100%; }

    /* ← PAGE IMAGE MODAL STYLES ← */
   #paperSelectModal {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.7);
  z-index:10000;
  font-family: 'Segoe UI', sans-serif;
}

.modal-content {
  display: flex;
  gap: 30px;
  margin: 20px 0;
}

.selection-section {
  flex: 1;
  text-align: center;
}

.selection-section h4 {
  margin: 0 0 15px 0;
  font-size: 18px;
  color: #000000;
  font-weight: 600;
}

.show-more-btn {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  border: none;
  background: #3498db;
  color: #fff;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  text-align: center;
}

.show-more-btn:hover {
  background: #2980b9;
}

.options-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

.option {
   display: flex;
  flex-direction: column;
  align-items: center; /* This centers everything horizontally */
  text-align: center; /* This centers the text */
  cursor: pointer;
  transition: all 0.3s ease;
  border-radius: 8px;
  padding: 10px;
}

.option:hover {
  background: rgba(52, 152, 219, 0.1);
  transform: translateY(-2px);
}

.option.selected {
  background: rgba(52, 152, 219, 0.1);
  box-shadow: 0 0 0 2px #3498db;
}

.option img {
  width: 100%;
  height: 120px;
  object-fit: contain;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-bottom: 8px;
}

.option .preview {
  width: 100%;
  height: 120px;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-bottom: 8px;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}


.custom-bg {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: #7f8c8d;
  background-color: #f5f5f5;
}

.option label {
  display: block;
  font-size: 14px;
  color: #34495e;
  margin-top: 5px;
}

.modal-footer {
  margin-top: 20px;
}

.modal-footer button {
  padding: 12px 24px;
  font-size: 16px;
  background: #2980b9;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
}

.modal-footer button:hover {
  background: #3498db;
}

#paperSelectModal .modal {
  background: #ffffff;
  padding: 30px;
  border-radius: 12px;
  width: 800px; /* Increased width */
  max-width: 90vw;
  text-align: center;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  animation: fadeInUp 0.4s ease-out;
}

#paperSelectModal h3 {
  margin-top:0;
  font-size: 22px;
  color: #5391cf;
  margin-bottom: 20px;
}

.page-option {
  display: inline-block;
  margin: 20px 10px;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border-radius: 8px;
  padding: 6px;
  position: relative;
}

.page-option:hover {
  background: rgba(52, 152, 219, 0.1);
  box-shadow: 0 0 12px rgba(52, 152, 219, 0.5);
  transform: scale(1.05);
}

.page-option img {
  width: 100px;
  height: auto;
  border: 2px solid #34495e;
  border-radius: 4px;
  transition: border-color 0.3s ease;
}

.page-option.selected {
  animation: pop 0.4s ease;
  box-shadow: 0 0 20px rgba(52, 152, 219, 0.7);
  background: rgba(52, 152, 219, 0.1);
  border-radius: 8px;
  transform: scale(1.05);
}

.page-option.selected img {
  border: 3px solid #2980b9;
  box-shadow: 0 4px 10px rgba(41, 128, 185, 0.6);
}

.page-option label {
  display: block;
  margin-top: 5px;
  font-size: 14px;
  color: #34495e;
}

#xDistanceGuide, #yDistanceGuide { 
  position: absolute; 
  background: rgba(46, 204, 113, 0.6); /* Green color for distance guides */
  z-index: 999; 
  display: none; 
}
#xDistanceGuide { height: 1px; width: 100%; }
#yDistanceGuide { width: 1px; height: 100%; }

.distance-tooltip {
  position: absolute;
  background: #2c3e50;
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 11px;
  z-index: 1000;
  display: none;
  pointer-events: none;
}

/* Add to your existing styles */
.selection-options {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}

.page-options, .background-options {
  flex: 1;
}

.background-options h4, .page-options h4 {
  color: #34495e;
  margin-bottom: 10px;
  font-size: 16px;
}

.background-option {
  display: inline-block;
  margin: 10px;
  cursor: pointer;
  text-align: center;
}

.bg-preview {
  width: 100px;
  height: 140px;
  border: 2px solid #34495e;
  border-radius: 4px;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  margin-bottom: 5px;
  transition: all 0.3s ease;
}

.no-bg {
  background: linear-gradient(45deg, #eee 25%, #fff 25%, #fff 50%, #eee 50%, #eee 75%, #fff 75%);
  background-size: 20px 20px;
}


.background-option.selected .bg-preview {
  border: 3px solid #2980b9;
  box-shadow: 0 4px 10px rgba(41, 128, 185, 0.6);
}

.background-option label {
  display: block;
  font-size: 14px;
  color: #34495e;
}

input[type="range"] {
  width: 100%;
  margin: 8px 0;
}

/* Animations */
@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}



@keyframes fadeInUp {
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Add to your existing CSS */
.label-box[data-placeholder]:empty:before {
 
  color: #999;
  font-style: italic;
}

.draggable-label.blank-label::after {
  
  margin-right: 8px;
  font-weight: bold;
  color: rgba(255, 255, 255, 0.8);
}







.labels-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px 0 8px 0;
  padding-bottom: 5px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  cursor: pointer;
  user-select: none;
  transition: all 0.3s ease;
}

.labels-header:hover {
  border-bottom-color: rgba(255,255,255,0.4);
}

/* Style for the line label in the sidebar */


/* Updated draggable label styles for both blank labels and lines */
.draggable-label.blank-label,
.draggable-label.line-label {
  /* Glass morphism effect */
  background: linear-gradient(
    to bottom right,
    rgba(255, 255, 255, 0.2),
    rgba(255, 255, 255, 0.1)
  );
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 
    0 4px 6px rgba(0, 0, 0, 0.1),
    inset 0 0 0 1px rgba(255, 255, 255, 0.2),
    inset 0 -20px 30px rgba(0, 0, 0, 0.1);
  position: relative;
  overflow: hidden;
  padding: 3px;
  margin-bottom: 10px;
  cursor: grab;
  border-radius: 4px;
  text-align: center;
  color: rgba(255, 255, 255, 0.9);
  transition: all 0.3s ease;
}

/* Hover state for both */
.draggable-label.blank-label:hover,
.draggable-label.line-label:hover {
  background: rgba(255, 255, 255, 0.3);
  box-shadow: 
    0 6px 8px rgba(0, 0, 0, 0.15),
    inset 0 0 0 1px rgba(255, 255, 255, 0.3),
    inset 0 -20px 30px rgba(0, 0, 0, 0.15);
  color: white;
}

/* Pseudo-element for the gradient effect */
.draggable-label.blank-label::before,
.draggable-label.line-label::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.4) 0%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(255, 255, 255, 0.4) 100%
  );
  z-index: -1;
}

/* Specific styles for blank label */



/* Style for the line when it's on the canvas */
.label-box.line-element {
  background: transparent;
  border: none;
  overflow: hidden;
  height: 234px;
  width: 738px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
}

/* Add to your existing CSS */
.center-indicator {
  display: none;
  pointer-events: none;
}

.space-indicator {
  display: none;
  pointer-events: none;
}

.equal-margin-indicator {
  position: absolute;
  width: 12px;
  height: 12px;
  background: #2ecc71;
  border-radius: 50%;
  z-index: 1000;
  display: none;
}

.label-box.line-element::after {
  content: "";
  display: block;
  width: 100%;
  height: 2px;
  background-color: #000; /* Default line color */
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.toggle-labels {
  background: none;
  border: none;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  padding: 0;
  color: white;
  transition: all 0.3s ease;
}

.toggle-labels:hover {
  background: rgba(255,255,255,0.1);
}

.toggle-labels svg {
  transition: transform 0.3s ease;
}

.labels-container {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out, opacity 0.2s ease;
  opacity: 0;
}

.values-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px 0 8px 0;
  padding-bottom: 5px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  cursor: pointer;
  user-select: none;
  transition: all 0.3s ease;
}

.values-header:hover {
  border-bottom-color: rgba(255,255,255,0.4);
}

.toggle-values {
  background: none;
  border: none;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  padding: 0;
  color: white;
  transition: all 0.3s ease;
}

.toggle-values:hover {
  background: rgba(255,255,255,0.1);
}

.values-container {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out, opacity 0.2s ease;
  opacity: 0;
}

.values-container.expanded {
  max-height: 500px;
  opacity: 1;
  transition: max-height 0.3s ease-in, opacity 0.3s ease 0.1s;
}

.labels-container.expanded {
  max-height: 500px; /* Adjust based on your content */
  opacity: 1;
  transition: max-height 0.3s ease-in, opacity 0.3s ease 0.1s;
}

/* Icons Animation */
.labels-container.expanded ~ .labels-header .plus-icon {
  transform: rotate(90deg);
}

.labels-container.expanded ~ .labels-header .minus-icon {
  display: block;
}

.labels-container.expanded ~ .labels-header .plus-icon {
  display: none;
}

/* Styles for all collapsible sections */
.styles-header,
.background-header,
.controls-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px 0 8px 0;
  padding-bottom: 5px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  cursor: pointer;
  user-select: none;
  transition: all 0.3s ease;
}

.styles-header:hover,
.background-header:hover,
.controls-header:hover {
  border-bottom-color: rgba(255,255,255,0.4);
}

.toggle-styles,
.toggle-background,
.toggle-controls {
  background: none;
  border: none;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  padding: 0;
  color: white;
  transition: all 0.3s ease;
}

.toggle-styles:hover,
.toggle-background:hover,
.toggle-controls:hover {
  background: rgba(255,255,255,0.1);
}

.styles-container,
.background-container,
.controls-container {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out, opacity 0.2s ease;
  opacity: 0;
}

.styles-container.expanded,
.background-container.expanded,
.controls-container.expanded {
  max-height: 1000px; /* Adjust based on content */
  opacity: 1;
  transition: max-height 0.3s ease-in, opacity 0.3s ease 0.1s;
}

/* Specific adjustments for controls section */
.controls-container h4 {
  margin: 15px 0 8px 0;
  color: white;
  font-weight: normal;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  padding-bottom: 5px;
}


/* Crop Modal Styles */
#cropModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.7);
  z-index: 10001;
  font-family: 'Segoe UI', sans-serif;
}

 #cropModal .modal {
    width: 600px;
    max-width: 90vw;
    padding: 30px;
     overflow-y: auto;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    animation: fadeInUp 0.4s ease-out;
  }

  #cropModal h3 {
    margin-top: 0;
    font-size: 22px;
    color: #5391cf;
    margin-bottom: 20px;
    text-align: center;
  }

  .crop-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    flex-wrap: wrap;
    gap: 15px;
  }

  .crop-controls-group {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .crop-ratio-selector {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .crop-ratio-selector label {
    font-weight: 600;
    color: #34495e;
    white-space: nowrap;
  }

  .crop-ratio-selector select {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #ddd;
    background: white;
    color: #34495e;
    font-size: 14px;
    min-width: 180px;
  }

  .zoom-controls {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .zoom-controls button {
    padding: 8px 12px;
    background: #2980b9;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .zoom-controls button:hover {
    background: #3498db;
  }

  .zoom-controls button svg {
    width: 14px;
    height: 14px;
    fill: currentColor;
  }

  /* Add to your existing styles */
.alignment-indicator {
  position: absolute;
  width: 8px;
  height: 8px;
  background: #3498db;
  border-radius: 50%;
  z-index: 1000;
  display: none;
}

.alignment-indicator.left {
  left: -12px;
  top: 50%;
  transform: translateY(-50%);
}

.alignment-indicator.right {
  right: -12px;
  top: 50%;
  transform: translateY(-50%);
}

  .zoom-percentage {
    display: flex;
    align-items: center;
    margin-left: 10px;
    background: white;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ddd;
  }

  .zoom-percentage input {
    width: 50px;
    padding: 4px;
    border: none;
    text-align: center;
    font-size: 14px;
    color: #34495e;
  }

  .zoom-percentage span {
    margin-left: 5px;
    color: #7f8c8d;
    font-size: 14px;
  }

  .crop-container {
    width: 100%;
    height: 500px;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    background: #f5f5f5;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .crop-preview {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #cropImage {
    position: absolute;
    max-width: none;
    cursor: move;
    transform-origin: 0 0;
    transition: transform 0.2s ease;
  }

  .crop-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    box-shadow: inset 0 0 0 2px rgba(52, 152, 219, 0.8);
    pointer-events: none;
    border-radius: 6px;
  }

  .crop-modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #eee;
  }

  .crop-modal-footer button {
    padding: 10px 24px;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
  }

  .crop-modal-footer button:first-child {
    background: #2980b9;
    color: white;
    border: none;
  }

  .crop-modal-footer button:first-child:hover {
    background: #3498db;
  }

  .crop-modal-footer button:last-child {
    background: white;
    color: #34495e;
    border: 1px solid #ddd;
  }

  .crop-modal-footer button:last-child:hover {
    background: #f8f9fa;
    border-color: #ccc;
  }

  @media (max-width: 768px) {
    .crop-controls {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .crop-controls-group {
      width: 100%;
      justify-content: space-between;
    }
    
    .crop-ratio-selector {
      flex: 1;
    }
    
    .zoom-controls {
      flex: 1;
      justify-content: flex-end;
    }
  }

  /* Signature Section Styles */
.signature-container {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out, opacity 0.2s ease;
  opacity: 0;
}

.signature-container.expanded {
  max-height: 500px;
  opacity: 1;
  transition: max-height 0.3s ease-in, opacity 0.3s ease 0.1s;
}

.signature-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px 0 8px 0;
  padding-bottom: 5px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  cursor: pointer;
  user-select: none;
  transition: all 0.3s ease;
}

.signature-header:hover {
  border-bottom-color: rgba(255,255,255,0.4);
}

.toggle-signature {
  background: none;
  border: none;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  padding: 0;
  color: white;
  transition: all 0.3s ease;
}

.toggle-signature:hover {
  background: rgba(255,255,255,0.1);
}

/* Add this to your existing CSS */
.margin-indicator {
  position: absolute;
  width: 8px;
  height: 8px;
  background: #e74c3c;
  border-radius: 50%;
  z-index: 1000;
  display: none;
}

.margin-indicator.left-margin {
  left: 0;
  top: 50%;
  transform: translateY(-50%);
}

.margin-indicator.right-margin {
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}

.equal-margin-indicator {
  position: absolute;
  width: 12px;
  height: 12px;
  background: #2ecc71;
  border-radius: 50%;
  z-index: 1000;
  display: none;
}

.equal-margin-indicator.left {
  left: -15px;
  top: 50%;
  transform: translateY(-50%);
}

.equal-margin-indicator.right {
  right: -15px;
  top: 50%;
  transform: translateY(-50%);
}


  </style>
</head>
<body>

  <!-- 📐 PAPER SIZE SELECTION MODAL -->
 <div id="paperSelectModal">
  <div class="modal">
    <h3>Report Layout Setup</h3>
    
    <div class="modal-content">
      <!-- Paper Size Selection -->
      <div class="selection-section">
        <h4>Select Paper Size</h4>
        <div class="options-grid">
          <div class="option" data-size="A4" onclick="selectPage('A4')">
            <img src="./images/A4.png" alt="A4 Page">
            <label>A4</label>
          </div>
          <div class="option" data-size="A5" onclick="selectPage('A5')">
            <img src="./images/A5.png" alt="A5 Page">
            <label>A5</label>
          </div>
          <div class="option" data-size="B4" onclick="selectPage('B4')">
            <img src="./images/B4.png" alt="B4 Page">
            <label>B4</label>
          </div>
          <div class="option" data-size="Letter" onclick="selectPage('Letter')">
            <img src="./images/Letter.png" alt="Letter Page">
            <label>Letter</label>
          </div>
        </div>
      </div>
      
      <!-- Background Selection -->
      <div class="selection-section">
        <h4>Select Background</h4>
        <div class="options-grid">
          <div class="option" onclick="selectBackground('none')">
            <div class="preview no-bg"></div>
            <label>No Background</label>
          </div>
          <div class="option" onclick="selectBackground('letterhead')">
            <div class="preview" style="background-image: url('./images/letterhead.png')"></div>
            <label>Sivasakthi Letterhead</label>
          </div>
          <div class="option" onclick="selectBackground('grid')">
            <div class="preview" style="background-image: url('./images/MDC.png')"></div>
            <label>MDC Letterhead</label>
          </div>
          <div class="option" onclick="selectBackground('custom')">
            <div class="preview custom-bg">+</div>
            <label>Custom Image</label>
            <input type="file" id="customBgUpload" accept="image/*" style="display: none;">
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button onclick="startDesigning()">Start Designing</button>
    </div>
  </div>
</div>

<!-- ✂️ CROP MODAL -->
<div id="cropModal" style="display: none;">
  <div class="modal">
    <h3>Crop Background Image</h3>
    
    <div class="crop-controls">
      <div class="crop-controls-group">
        <div class="crop-ratio-selector">
          <label for="cropRatio">Crop Ratio:</label>
          <select id="cropRatio">
            <option value="A4">A4 (210×297mm)</option>
            <option value="A5">A5 (148×210mm)</option>
            <option value="B4">B4 (250×353mm)</option>
            <option value="Letter">Letter (216×279mm)</option>
          </select>
        </div>
      </div>
      
      <div class="crop-controls-group">
        <div class="zoom-controls">
          <button onclick="zoomCropIn()" title="Zoom In">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
          </button>
          <button onclick="zoomCropOut()" title="Zoom Out">
            <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg>
          </button>
          <button onclick="resetCropZoom()" title="Reset Zoom">
            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
          </button>
           <div class="zoom-percentage">
          <input type="number" id="zoomPercentage" min="0" max="150" step="1" value="100">
          <span>%</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="crop-container">
      <div class="crop-preview">
        <img id="cropImage" src="" alt="Background to crop">
        <div class="crop-overlay"></div>
      </div>
    </div>
    
    <div class="crop-modal-footer">
      <button onclick="applyCrop()">Apply Crop</button>
      <button onclick="skipCrop()">Skip Cropping</button>
    </div>
  </div>
</div>


  <!-- 🧰 SIDEBAR -->
  <div id="sidebar">
<!-- Replace the entire labels and values sections in the sidebar with this: -->
<h3 class="labels-header">
  <span>LABELS</span>
  <button class="toggle-labels">
    <svg class="plus-icon" width="16" height="16" viewBox="0 0 16 16">
      <path d="M8 1v14M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg class="minus-icon" width="16" height="16" viewBox="0 0 16 16" style="display: none;">
      <path d="M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</h3>
<div class="labels-container">
  <div class="draggable-label blank-label" draggable="true" data-label="Blank Label">Blank Label</div>
  <!-- Add this new line element -->
  <div class="draggable-label line-label" draggable="true" data-label="Line">Line</div>
  <!-- Labels will be generated dynamically here -->
  <div id="dynamic-labels"></div>
  <button id="prevLabels" class="show-more-btn" style="display: none;">Previous</button>
  <button id="nextLabels" class="show-more-btn">Next</button>
</div>

<h3 class="values-header">
  <span>VALUES</span>
  <button class="toggle-values">
    <svg class="plus-icon" width="16" height="16" viewBox="0 0 16 16">
      <path d="M8 1v14M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg class="minus-icon" width="16" height="16" viewBox="0 0 16 16" style="display: none;">
      <path d="M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</h3>
<div class="values-container">
  <!-- Values will be generated dynamically here -->
  <div id="dynamic-values"></div>
<button id="prevValues" class="show-more-btn" style="display: none;">Previous</button>
<button id="nextValues" class="show-more-btn">Next</button>
</div>

<!-- Signature Section -->
<!-- Signature Section -->
<h3 class="signature-header">
  <span>SIGNATURE</span>
  <button class="toggle-signature">
    <svg class="plus-icon" width="16" height="16" viewBox="0 0 16 16">
      <path d="M8 1v14M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg class="minus-icon" width="16" height="16" viewBox="0 0 16 16" style="display: none;">
      <path d="M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</h3>
<div class="signature-container">
  <a href="https://demo.medecue.com/managesettings.html" id="setupSignature" target="_blank" style="color: #3498db; text-decoration: none; margin-bottom: 10px; display: block;">Setup Signature</a>
  <div id="dynamic-signatures"></div>
</div>

<!-- Styles Section -->
<h3 class="styles-header">
  <span>STYLES</span>
  <button class="toggle-styles">
    <svg class="plus-icon" width="16" height="16" viewBox="0 0 16 16">
      <path d="M8 1v14M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg class="minus-icon" width="16" height="16" viewBox="0 0 16 16" style="display: none;">
      <path d="M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</h3>
<div class="styles-container">
  <label>Font Size</label>
  <select id="fontSize">
    <option value="11px">11</option>
    <option value="12px" selected>12</option>
    <option value="14px">14</option>
    <option value="18px">18</option>
    <option value="24px">24</option>
    <option value="30px">30</option>
  </select>
  <label>Font Family</label>
  <select id="fontFamily">
    <option value="Arial">Arial</option>
    <option value="Georgia">Georgia</option>
    <option value="Courier New">Courier New</option>
    <option value="Times New Roman">Times New Roman</option>
  </select>
  <label>Font Color</label>
  <input type="color" id="fontColor" value="#000000">

  <div class="style-controls">
    <button id="btnBold"><strong>B</strong></button>
    <button id="btnItalic"><em>I</em></button>
    <button id="btnUnderline"><u>U</u></button>
  </div>
  <div class="style-controls">
    <button id="alignLeft">Left</button>
    <button id="alignCenter">Center</button>
    <button id="alignRight">Right</button>
  </div>
</div>

<!-- Background Section -->
<h3 class="background-header">
  <span>BACKGROUND</span>
  <button class="toggle-background">
    <svg class="plus-icon" width="16" height="16" viewBox="0 0 16 16">
      <path d="M8 1v14M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg class="minus-icon" width="16" height="16" viewBox="0 0 16 16" style="display: none;">
      <path d="M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</h3>
<div class="background-container">
  <label>Opacity</label>
  <input type="range" id="bgOpacity" min="10" max="100" value="50">
  <button id="toggleBackground">Toggle Background</button>
</div>

<!-- Controls Section -->
<h3 class="controls-header">
  <span>CONTROLS</span>
  <button class="toggle-controls">
    <svg class="plus-icon" width="16" height="16" viewBox="0 0 16 16">
      <path d="M8 1v14M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <svg class="minus-icon" width="16" height="16" viewBox="0 0 16 16" style="display: none;">
      <path d="M1 8h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</h3>
<div class="controls-container">
  <!-- Zoom Controls -->
  <button onclick="zoomIn()">Zoom In</button>
  <button onclick="zoomOut()">Zoom Out</button>
  <button onclick="resetZoom()">Reset Zoom</button>

  <!-- Action Controls -->
  <button id="clearAllLabels">Clear All Labels</button>
  <button id="deleteSelected">Delete Selected</button>

  <!-- Guide Settings -->
  <h4>GUIDE SETTINGS</h4>
  <label>Guide Color</label>
  <input type="color" id="guideColor" value="#e74c3c">
  <label>Distance Guide Color</label>
  <input type="color" id="distanceGuideColor" value="#2ecc71">
  <!-- <label>Minimum Spacing</label>
  <input type="range" id="minSpacing" min="10" max="100" value="20">
  <span id="minSpacingValue">20px</span> -->

  <div class="toggle-switch">
    <label for="toggleGuides">Show Guides</label>
    <input type="checkbox" id="toggleGuides" checked>
  </div>
  <div class="toggle-switch">
    <label for="toggleDistanceGuides">Show Distance </label>
    <input type="checkbox" id="toggleDistanceGuides" checked>
  </div>

  <!-- Export Controls -->
  <button id="exportJSON">Export JSON</button>
  <button id="exportPNG">Export as PNG</button>
</div>
</div>


  <!-- 🖼 Scrollable Canvas Wrapper -->
  <div id="canvasContainer">
    <div id="canvas">
      <div id="letterheadBackground"></div>
      <div id="xDistanceGuide"></div>
      <div id="yDistanceGuide"></div>
      <div id="distanceValue" class="distance-tooltip"></div>
      <div id="xGuide"></div>
      <div id="yGuide"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>

    // Sample data (this would come from API in real implementation)
const reportData = {
  Age: "age",
  Barcode: "barcode",
  Patient_Id: "client_id",
  Collected_Date:"collected_date",
  Collected_On: "collected_on",
  Collection: "collection",
  Created_At: "created_at",
  Culture_Id: "collection",
  Date: "date",
  Delete_status: "delete_status",
  Discount: "discount",
  Doctor_Email: "doctor_email",
  Doctor_Id: "doctor_id",
  Referred_By : "doctor_name",
  Doctor_Phone: "doctor_phone",
  Due_Amount: "due_amount",
  Group_Id: "group_id",
  Hospital_Name: "hospital_name",
  Id_No: "id_no",
  Logged_In_Id: "loggedinid",
  multisign: "multisign",
  Order_Date: "order_date",
  Order_Id: "order_id",
  Orderedtestgroup: "orderedtestgroup",
  Paid_Amount: "paid_amount",
  Patient_Address: "patient_address",
  Patient_Code: "patient_code",
  Patient_DOB: "patient_dob",
  Patient_Email: "patient_email",
  Patient_Gender: "patient_gender",
  Patient_Name: "patient_name",
  Patient_Phone: "patient_phone",
  Prescription: "prescription",
  Recievedsample: "recievedsample",
  Report_Date: "report_date",
  Report_Id: "report_id",
  Report_Status: "report_status",
  Reported_On: "reported_on",
  Sample_Id: "sample_id",
  Signature_Id: "signature_id",
  Signatures: "signatures",
  Status: "status",
  Subtotal: "subtotal",
  ta_Time: "ta_time",
  Test_ID: "test_id",
  Testorder: "testorder",
  Workorder_ID: "workorder_id",
  Workorder_Status: "workorder_status"
};

let cropZoom = 1;
let cropOffsetX = 0;
let cropOffsetY = 0;
let isDragging = false;
let startX, startY;
let currentCropRatio = 'A4';

// Variables for pagination
let currentLabelPage = 1;
let currentValuePage = 1;
const itemsPerPage = 6;

// Add this after the cropZoom variable declarations
document.getElementById('zoomPercentage').addEventListener('change', function(e) {
  const percentage = parseInt(e.target.value);
  if (!isNaN(percentage)) {
    setCropZoom(percentage / 100);
  }
});

function setCropZoom(zoom) {
  // Convert zoom to percentage (0-150%)
  const percentage = Math.round(zoom * 100);
  // Ensure percentage stays within bounds (0-150)
  const clampedPercentage = Math.max(0, Math.min(150, percentage));
  
  // Convert back to zoom factor (0-1.5)
  cropZoom = clampedPercentage / 100;
  
  document.getElementById('zoomPercentage').value = clampedPercentage;
  document.getElementById('cropImage').style.transform = `translate(${cropOffsetX}px, ${cropOffsetY}px) scale(${cropZoom})`;
}

// Update the existing zoom functions to use setCropZoom
function zoomCropIn() {
  const currentPercentage = parseInt(document.getElementById('zoomPercentage').value);
  if (currentPercentage < 150) {
    setCropZoom(cropZoom + 0.1);
  }
}

function zoomCropOut() {
  const currentPercentage = parseInt(document.getElementById('zoomPercentage').value);
  if (currentPercentage > 0) {
    setCropZoom(cropZoom - 0.1);
  }
}

function resetCropZoom() {
  setCropZoom(1);
}

// Update the image load handler to set initial percentage


// Helper function to crop image
function cropImage(imageSrc, cropX, cropY, cropWidth, cropHeight) {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    
    img.onload = function() {
      canvas.width = cropWidth;
      canvas.height = cropHeight;
      ctx.drawImage(img, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
      resolve(canvas.toDataURL());
    };
    
    img.src = imageSrc;
  });
}

// Helper function to get crop dimensions
function getCropDimensions() {
  const container = document.querySelector('.crop-container');
  const overlay = document.querySelector('.crop-overlay');
  const img = document.getElementById('cropImage');
  
  // Get relative positions
  const containerRect = container.getBoundingClientRect();
  const overlayRect = overlay.getBoundingClientRect();
  const imgRect = img.getBoundingClientRect();
  
  // Calculate crop coordinates relative to image
  const scaleX = img.naturalWidth / imgRect.width;
  const scaleY = img.naturalHeight / imgRect.height;
  
  const cropX = (overlayRect.left - imgRect.left) * scaleX;
  const cropY = (overlayRect.top - imgRect.top) * scaleY;
  const cropWidth = overlayRect.width * scaleX;
  const cropHeight = overlayRect.height * scaleY;
  
  return { cropX, cropY, cropWidth, cropHeight };
}

// Update the showCropModal function
function showCropModal(imageSrc) {
  document.getElementById('paperSelectModal').style.display = 'none';
  document.getElementById('cropModal').style.display = 'flex';
  
  const cropImage = document.getElementById('cropImage');
  cropImage.src = imageSrc;
  
  // Reset crop settings
  cropZoom = 1;
  cropOffsetX = 0;
  cropOffsetY = 0;
  
  // Set initial crop ratio based on selected page
  document.getElementById('cropRatio').value = selectedPage;
  currentCropRatio = selectedPage;
  updateCropOverlay();
  
  // Initialize dragging
  cropImage.onmousedown = function(e) {
    if (e.target === cropImage) { // Only drag on the image itself
      isDragging = true;
      startX = e.clientX - cropOffsetX;
      startY = e.clientY - cropOffsetY;
      e.preventDefault();
    }
  };
  
  document.onmousemove = function(e) {
    if (!isDragging) return;
    
    cropOffsetX = e.clientX - startX;
    cropOffsetY = e.clientY - startY;
    
    cropImage.style.transform = `translate(${cropOffsetX}px, ${cropOffsetY}px) scale(${cropZoom})`;
  };
  
  document.onmouseup = function() {
    isDragging = false;
  };
  
  // Zoom with mouse wheel - updated to 2% increments
  cropImage.onwheel = function(e) {
    e.preventDefault();
    const delta = e.deltaY > 0 ? -0.02 : 0.02; // 2% increment
    setCropZoom(cropZoom + delta);
  };
  
  // Wait for image to load before positioning
  cropImage.onload = function() {
    // Reset transform first
    cropImage.style.transform = 'translate(0, 0) scale(1)';
    
    const container = document.querySelector('.crop-container');
    const containerWidth = container.clientWidth;
    const containerHeight = container.clientHeight;
    
    // Get natural dimensions of the image
    const imgWidth = cropImage.naturalWidth;
    const imgHeight = cropImage.naturalHeight;
    
    // Calculate scale to fit container while maintaining aspect ratio
    const scale = Math.min(
      containerWidth / imgWidth,
      containerHeight / imgHeight
    );
    
    // Apply initial scale and center the image
    cropZoom = scale;
   // Ensure initial zoom is between 0-150%
  if (cropZoom > 1.5) cropZoom = 1.5;
  if (cropZoom < 0) cropZoom = 0;
  
  cropOffsetX = (containerWidth - imgWidth * cropZoom) / 2;
  cropOffsetY = (containerHeight - imgHeight * cropZoom) / 2;
  
  cropImage.style.width = `${imgWidth}px`;
  cropImage.style.height = `${imgHeight}px`;
  cropImage.style.transform = `translate(${cropOffsetX}px, ${cropOffsetY}px) scale(${cropZoom})`;

  setCropZoom(cropZoom);
  };
}

function updateCropOverlay() {
  const { w, h } = paperSizes[currentCropRatio];
  const container = document.querySelector('.crop-container');
  const overlay = document.querySelector('.crop-overlay');
  
  // Calculate aspect ratio
  const aspectRatio = w / h;
  
  // Set container size while maintaining aspect ratio
  if (aspectRatio > 1) {
    // Wider than tall
    container.style.width = '600px';
    container.style.height = `${600 / aspectRatio}px`;
  } else {
    // Taller than wide
    container.style.height = '400px';
    container.style.width = `${400 * aspectRatio}px`;
  }
  
  // Position overlay to cover the container
  overlay.style.width = '100%';
  overlay.style.height = '100%';
  overlay.style.left = '0';
  overlay.style.top = '0';
}


async function applyCrop() {
  const img = document.getElementById('cropImage');
  const { cropX, cropY, cropWidth, cropHeight } = getCropDimensions();
  
  try {
    const croppedImage = await cropImage(img.src, cropX, cropY, cropWidth, cropHeight);
    document.getElementById('cropModal').style.display = 'none';
    setupCanvasWithBackground(croppedImage);
  } catch (error) {
    console.error('Error cropping image:', error);
    alert('Error cropping image. Please try again.');
  }
}


function skipCrop() {
  document.getElementById('cropModal').style.display = 'none';
  setupCanvasWithBackground(document.getElementById('cropImage').src);
}

function setupCanvasWithBackground(bgImage) {
  const { w, h } = paperSizes[selectedPage];
  const pw = w * PPM, ph = h * PPM;
  canvas.style.width = `${pw}px`;
  canvas.style.height = `${ph}px`;
  
  // Set letterhead background
  const letterheadBg = document.getElementById('letterheadBackground');
  letterheadBg.style.width = `${pw}px`;
  letterheadBg.style.height = `${ph}px`;
  
  if (bgImage) {
    // Apply the background image
    letterheadBg.style.backgroundImage = `url(${bgImage})`;
    letterheadBg.style.display = 'block';
  } else {
    // No background
    letterheadBg.style.backgroundImage = 'none';
    letterheadBg.style.display = 'none';
  }
  
  document.getElementById('paperSelectModal').style.display = 'none';
  enableInteractions();
}
// Update crop ratio when changed
document.getElementById('cropRatio').addEventListener('change', function(e) {
  currentCropRatio = e.target.value;
  updateCropOverlay();
});

// Function to generate label elements
function generateLabels(page = 1) {
  const labelsContainer = document.getElementById('dynamic-labels');
  labelsContainer.innerHTML = '';
  
  const keys = Object.keys(reportData);
  const startIdx = (page - 1) * itemsPerPage;
  const endIdx = startIdx + itemsPerPage;
  
  keys.slice(startIdx, endIdx).forEach(key => {
    if (reportData[key] !== null && reportData[key] !== "") {
      const labelDiv = document.createElement('div');
      labelDiv.className = 'draggable-label';
      labelDiv.draggable = true;
      labelDiv.setAttribute('data-label', key);
      labelDiv.textContent = formatLabelText(key);
      labelsContainer.appendChild(labelDiv);
    }
  });
  
  // Show/hide navigation buttons
  const prevLabelsBtn = document.getElementById('prevLabels');
  const nextLabelsBtn = document.getElementById('nextLabels');
  
  prevLabelsBtn.style.display = page > 1 ? 'block' : 'none';
  nextLabelsBtn.style.display = endIdx < keys.length ? 'block' : 'none';
}

// Function to generate value elements
// Function to generate value elements (updated version without colons)
function generateValues(page = 1) {
  const valuesContainer = document.getElementById('dynamic-values');
  valuesContainer.innerHTML = '';
  
  const keys = Object.keys(reportData);
  const startIdx = (page - 1) * itemsPerPage;
  const endIdx = startIdx + itemsPerPage;
  
  keys.slice(startIdx, endIdx).forEach(key => {
    if (reportData[key] !== null && reportData[key] !== "") {
      const valueDiv = document.createElement('div');
      valueDiv.className = 'draggable-label';
      valueDiv.draggable = true;
      valueDiv.setAttribute('data-label', reportData[key]);
      valueDiv.textContent = reportData[key];
      valuesContainer.appendChild(valueDiv);
    }
  });
  
  // Show/hide navigation buttons
  const prevValuesBtn = document.getElementById('prevValues');
  const nextValuesBtn = document.getElementById('nextValues');
  
  prevValuesBtn.style.display = page > 1 ? 'block' : 'none';
  nextValuesBtn.style.display = endIdx < keys.length ? 'block' : 'none';
}



// Helper function to format label text (capitalize and add spaces)
function formatLabelText(key) {
  return key.replace(/_/g, ' ')
            .replace(/([A-Z])/g, ' $1')
            .replace(/^./, str => str.toUpperCase());
}

// Helper function to format value text
function formatValueText(value) {
  if (value === null || value === undefined) return '';
  return value.toString();
}

// Event listeners for show more buttons
document.getElementById('nextLabels').addEventListener('click', () => {
  currentLabelPage++;
  generateLabels(currentLabelPage);
});

document.getElementById('prevLabels').addEventListener('click', () => {
  currentLabelPage--;
  generateLabels(currentLabelPage);
});

document.getElementById('nextValues').addEventListener('click', () => {
  currentValuePage++;
  generateValues(currentValuePage);
});

document.getElementById('prevValues').addEventListener('click', () => {
  currentValuePage--;
  generateValues(currentValuePage);
});


// Initialize the labels and values when the page loads
document.addEventListener('DOMContentLoaded', () => {
  generateLabels();
  generateValues();
  
  // Make sure the draggable functionality works for dynamically generated elements
  document.addEventListener('mouseover', () => {
    document.querySelectorAll('.draggable-label').forEach(lbl => {
      lbl.ondragstart = e => e.dataTransfer.setData('text/plain', lbl.dataset.label);
    });
  });
});

let selectedBackground = 'none';
let customBackgroundImage = null;

function selectBackground(bgType) {
  selectedBackground = bgType;
  
  // Remove selection from all background options
  document.querySelectorAll('.selection-section:nth-child(2) .option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // Add selection to clicked option
  const selectedOption = document.querySelector(`.option[onclick="selectBackground('${bgType}')"]`);
  if (selectedOption) {
    selectedOption.classList.add('selected');
  }
  
  // Handle custom image upload
  if (bgType === 'custom') {
    document.getElementById('customBgUpload').click();
  }
}
// Handle custom background upload
document.getElementById('customBgUpload').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      customBackgroundImage = event.target.result;
      // Update the preview - now matching your actual HTML structure
      const customPreview = document.querySelector('.option[onclick="selectBackground(\'custom\')"] .preview');
      if (customPreview) {
        customPreview.style.backgroundImage = `url(${customBackgroundImage})`;
        customPreview.textContent = '';
      }
    };
    reader.readAsDataURL(file);
  }
});

let guideSettings = {
  enabled: true,
  distanceEnabled: true,
  guideColor: '#e74c3c',
  distanceColor: '#2ecc71',
  minSpacing: 20
};

    const paperSizes = {
      A4: { w: 210, h: 297 },
      A5: { w: 148, h: 210 },
      B4: { w: 250, h: 353 },
      Letter: { w: 216, h: 279 }
    };
    const PPM = 3.78;
    let zoomLevel = 1, editMode = true, selectedElement = null;


    
    const canvas = document.getElementById('canvas'),
    xGuide = document.getElementById('xGuide'), yGuide = document.getElementById('yGuide');

   function selectPage(page) {
  document.querySelectorAll('.option[data-size]').forEach(option => {
    option.classList.remove('selected');
  });
  const selectedOption = document.querySelector(`.option[data-size="${page}"]`);
  selectedOption.classList.add('selected');
  selectedPage = page;
}

function startDesigning() {
  if (!selectedPage) {
    alert('Please select a page size!');
    return;
  }
  
  // Skip cropping for predefined backgrounds and no background
  if (selectedBackground === 'none' || 
      selectedBackground === 'letterhead' || 
      selectedBackground === 'grid') {
    setupCanvas();
    return;
  }
  
  // Show crop modal only for custom background
  if (selectedBackground === 'custom') {
    if (customBackgroundImage) {
      showCropModal(customBackgroundImage);
    } else {
      // No custom image selected, proceed without background
      setupCanvasWithBackground(null);
    }
    return;
  }
  
  // Default case (shouldn't normally reach here)
  setupCanvasWithBackground(null);
}


// Add this to your variables section
let signatureData = [];

// Add this to your DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', () => {
  generateLabels();
  generateValues();
  
  // Add click handler for signature header
  document.querySelector('.signature-header').addEventListener('click', function() {
    const container = document.querySelector('.signature-container');
    container.classList.toggle('expanded');
    this.setAttribute('aria-expanded', container.classList.contains('expanded'));
    container.setAttribute('aria-hidden', !container.classList.contains('expanded'));
  });

  // Add click handler for setup signature link

  
  // Make sure the draggable functionality works for dynamically generated elements
  document.addEventListener('mouseover', () => {
    document.querySelectorAll('.draggable-label').forEach(lbl => {
      lbl.ondragstart = e => e.dataTransfer.setData('text/plain', lbl.dataset.label);
    });
  });
fetchSignatureData();

});

// Function to fetch signature data from API

async function fetchSignatureData() {
  try {
    // Get token from localStorage instead of hardcoding
    const token = localStorage.getItem('medToken');
    
    if (!token) {
      throw new Error('No authentication token found in localStorage');
    }

    
    // Create FormData object
    const formData = new FormData();
    formData.append('medtoken', token);

    const response = await fetch('https://clients.medecue.in/settings/getallsettings', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    console.log("API Response:", data);
    
    if (data.error) {
      throw new Error(data.message || 'Failed to fetch signature data');
    }

    if (!data.settingsdata || !Array.isArray(data.settingsdata)) {
      throw new Error('Invalid data structure received from API');
    }

    const settings = data.settingsdata[0];
    if (!settings || !settings.signatures) {
      throw new Error('No signature data found in settings');
    }

    signatureData = settings.signatures.filter(sig => sig.delete_status === 0);
    console.log("Filtered Signatures:", signatureData);
    
    if (signatureData.length === 0) {
      alert('No active signatures found in your account');
    }
    
    generateSignatures();
    
  } catch (error) {
    console.error('Error fetching signature data:', error);
    alert(`Failed to fetch signature data: ${error.message}`);
  }
}
// Function to generate signature elements

function generateSignatures() {
  const signaturesContainer = document.getElementById('dynamic-signatures');
  signaturesContainer.innerHTML = '';
  
  if (!signatureData || signatureData.length === 0) {
    signaturesContainer.innerHTML = `
      <div style="color: #ecf0f1; padding: 10px; text-align: center;">
        No signatures available. Click "Setup Signature" to configure.
      </div>
    `;
    return;
  }

  signatureData.forEach(signature => {
    const signatureDiv = document.createElement('div');
    signatureDiv.className = 'draggable-label';
    signatureDiv.draggable = true;
    signatureDiv.setAttribute('data-label', signature.sign_name);
    signatureDiv.textContent = signature.sign_name;
    
    // Add hover tooltip with display text
    signatureDiv.title = signature.display_text || signature.sign_name;
    
    signaturesContainer.appendChild(signatureDiv);
  });
}


function setupCanvas() {
  const { w, h } = paperSizes[selectedPage];
  const pw = w * PPM, ph = h * PPM;
  canvas.style.width = `${pw}px`;
  canvas.style.height = `${ph}px`;
  
  // Set letterhead background
  const letterheadBg = document.getElementById('letterheadBackground');
  letterheadBg.style.width = `${pw}px`;
  letterheadBg.style.height = `${ph}px`;
  
  // Apply selected background
  switch(selectedBackground) {
    case 'none':
      letterheadBg.style.backgroundImage = 'none';
      letterheadBg.style.display = 'none';
      break;
    case 'letterhead':
      letterheadBg.style.backgroundImage = 'url("./images/letterhead.png")';
      letterheadBg.style.display = 'block';
      break;
    case 'grid':
      letterheadBg.style.backgroundImage = 'url("./images/MDC.png")';
      letterheadBg.style.display = 'block';
      break;
    case 'custom':
      if (customBackgroundImage) {
        letterheadBg.style.backgroundImage = `url(${customBackgroundImage})`;
        letterheadBg.style.display = 'block';
      } else {
        letterheadBg.style.backgroundImage = 'none';
        letterheadBg.style.display = 'none';
      }
      break;
  }
  
  document.getElementById('paperSelectModal').style.display = 'none';
  enableInteractions();
}

    function setPaperSize(){
      const sel = document.getElementById('paperSize').value;
      const {w,h} = paperSizes[sel];
      const pw = w*PPM, ph = h*PPM;
      canvas.style.width = `${pw}px`;
      canvas.style.height = `${ph}px`;
      document.getElementById('paperSelectModal').style.display = 'none';
      enableInteractions();
    }

    function enableInteractions(){
    document.querySelectorAll('.draggable-label').forEach(lbl=>{
    lbl.ondragstart=e=>{
      // Use the formatted text for dragging
      e.dataTransfer.setData('text/plain', lbl.textContent);
    };
  });
  
  canvas.ondragover=e=>e.preventDefault();
  canvas.ondrop=e=>{
    e.preventDefault();
    const t=e.dataTransfer.getData('text/plain');
    const rect=canvas.getBoundingClientRect();
    createLabel(t, e.clientX-rect.left, e.clientY-rect.top);
  };

    
      document.getElementById('deleteSelected').onclick=()=>{if(selectedElement){selectedElement.remove(); saveLayout(); selectedElement=null;}};
      document.addEventListener('keydown', e=>{ if(e.key==='Delete'&&selectedElement){selectedElement.remove(); saveLayout(); selectedElement=null;} });

      document.getElementById('fontSize').onchange=e=>{if(selectedElement){selectedElement.style.fontSize=e.target.value; saveLayout();}};
      document.getElementById('fontColor').onchange=e=>{if(selectedElement){selectedElement.style.color=e.target.value; saveLayout();}};
      document.getElementById('fontFamily').onchange=e=>{if(selectedElement){selectedElement.style.fontFamily=e.target.value; saveLayout();}};
      ['btnBold','btnItalic','btnUnderline','alignLeft','alignCenter','alignRight']
        .forEach(id=>document.getElementById(id).onclick=()=>{
          if(!selectedElement) return;
          const s = selectedElement.style;
          if(id==='btnBold') s.fontWeight = s.fontWeight==='bold'?'normal':'bold';
          if(id==='btnItalic') s.fontStyle = s.fontStyle==='italic'?'normal':'italic';
          if(id==='btnUnderline') s.textDecoration = s.textDecoration==='underline'?'none':'underline';
          if(id==='alignLeft') s.textAlign='left';
          if(id==='alignCenter') s.textAlign='center';
          if(id==='alignRight') s.textAlign='right';
          saveLayout();
        });

      document.getElementById('exportJSON').onclick=()=>{
        localStorage.setItem('builderLayout', JSON.stringify(getLayoutData()));
        alert('Saved JSON');
      };
      document.getElementById('exportPNG').onclick=()=>{
        html2canvas(canvas).then(c=>{ const a=document.createElement('a'); a.download='layout.png'; a.href=c.toDataURL(); a.click(); });
      };

      document.getElementById('clearAllLabels').onclick = () => {
  if (confirm('Are you sure you want to remove all labels from the report?')) {
    document.querySelectorAll('.label-box').forEach(label => label.remove());
    saveLayout();
    selectedElement = null;
  }
};


// Guide controls
document.getElementById('guideColor').onchange = e => {
  guideSettings.guideColor = e.target.value;
  xGuide.style.background = yGuide.style.background = guideSettings.guideColor;
};
document.getElementById('distanceGuideColor').onchange = e => {
  guideSettings.distanceColor = e.target.value;
  xDistanceGuide.style.background = yDistanceGuide.style.background = guideSettings.distanceColor;
};
// document.getElementById('minSpacing').oninput = e => {
//   guideSettings.minSpacing = parseInt(e.target.value);
//   document.getElementById('minSpacingValue').textContent = `${guideSettings.minSpacing}px`;
// };
document.getElementById('toggleGuides').addEventListener('change', (e) => {
  guideSettings.enabled = e.target.checked;
  if (!guideSettings.enabled) clearSnap();
});
document.getElementById('toggleDistanceGuides').addEventListener('change', (e) => {
  guideSettings.distanceEnabled = e.target.checked;
  if (!guideSettings.distanceEnabled) {
    xDistanceGuide.style.display = yDistanceGuide.style.display = 'none';
    document.getElementById('distanceValue').style.display = 'none';
  }
});

// Add to enableInteractions() function
document.getElementById('bgOpacity').oninput = e => {
  document.getElementById('letterheadBackground').style.opacity = e.target.value / 100;
};
document.getElementById('toggleBackground').onclick = () => {
  const bg = document.getElementById('letterheadBackground');
  bg.style.display = bg.style.display === 'none' ? 'block' : 'none';
};

document.querySelector('.labels-header').addEventListener('click', function() {
  const container = document.querySelector('.labels-container');
  container.classList.toggle('expanded');
  
  // Update ARIA attributes for accessibility
  const isExpanded = container.classList.contains('expanded');
  this.setAttribute('aria-expanded', isExpanded);
  container.setAttribute('aria-hidden', !isExpanded);
});

document.querySelector('.values-header').addEventListener('click', function() {
  const container = document.querySelector('.values-container');
  container.classList.toggle('expanded');
  
  // Update ARIA attributes for accessibility
  const isExpanded = container.classList.contains('expanded');
  this.setAttribute('aria-expanded', isExpanded);
  container.setAttribute('aria-hidden', !isExpanded);
});

// Toggle Styles section
document.querySelector('.styles-header').addEventListener('click', function() {
  const container = document.querySelector('.styles-container');
  container.classList.toggle('expanded');
  this.setAttribute('aria-expanded', container.classList.contains('expanded'));
  container.setAttribute('aria-hidden', !container.classList.contains('expanded'));
});

// Toggle Background section
document.querySelector('.background-header').addEventListener('click', function() {
  const container = document.querySelector('.background-container');
  container.classList.toggle('expanded');
  this.setAttribute('aria-expanded', container.classList.contains('expanded'));
  container.setAttribute('aria-hidden', !container.classList.contains('expanded'));
});

// Toggle Controls section
document.querySelector('.controls-header').addEventListener('click', function() {
  const container = document.querySelector('.controls-container');
  container.classList.toggle('expanded');
  this.setAttribute('aria-expanded', container.classList.contains('expanded'));
  container.setAttribute('aria-hidden', !container.classList.contains('expanded'));
});


      loadLayout();
    }

// Modify the createLabel function
function createLabel(text, x, y) {
  // Get canvas dimensions
  const canvasRect = canvas.getBoundingClientRect();
  const canvasWidth = parseInt(canvas.style.width);
  const canvasHeight = parseInt(canvas.style.height);
  
  // Constrain position to be within canvas
  x = Math.max(0, Math.min(x, canvasWidth - 40));
  y = Math.max(0, Math.min(y, canvasHeight - 20));
  
  const div = document.createElement('div');
  div.className = 'label-box';
  
   if (text === "Line") {
    div.className = 'label-box line-element';
    div.style.width = '501px'; // Default width
    div.style.height = '50px'; // Default height
  } 
  
  // Handle blank label differently
  else if (text === "Blank Label") {
    div.className = 'label-box';
    div.setAttribute('data-placeholder', 'Enter your text here...');
    div.contentEditable = true;
  }
  // Check if this is a value (from VALUES section)
  else if (Object.values(reportData).includes(text)) {
    div.textContent = text;
    div.contentEditable = true;
  }
  // Check if this is a signature
  else if (signatureData.some(sig => sig.sign_name === text)) {
    const signature = signatureData.find(sig => sig.sign_name === text);
    div.textContent = signature.sign_name;
    div.setAttribute('data-signature', 'true');
    div.setAttribute('data-display-text', signature.display_text || '');
    div.contentEditable = false; // Signatures shouldn't be editable
  }
  else {
    // Store the original key in a data attribute
    div.setAttribute('data-original-key', text);
    // Apply the same formatting as in the sidebar
    div.textContent = formatLabelText(text);
    div.contentEditable = true;
  }
  
  div.style.left = `${x}px`; 
  div.style.top = `${y}px`; 
  div.style.fontSize = '14px';
  
  const r = document.createElement('div'); 
  r.className = 'resizer'; 
  div.appendChild(r);
  
  makeDraggable(div); 
  makeResizable(div, r); 
  canvas.appendChild(div); 
  saveLayout();
  
  // Focus the blank label when created
  if (text === "Blank Label") {
    div.focus();
  }
}

function makeDraggable(el){
  el.onmousedown=e=>{
    if(!editMode||e.target.classList.contains('resizer')) return;
    document.querySelectorAll('.label-box').forEach(b=>{
      b.classList.remove('selected'); 
      b.querySelector('.resizer').style.display='none';
    });
    el.classList.add('selected'); 
    selectedElement=el;
    el.querySelector('.resizer').style.display='block';
    
    startDrag(e,(dx,dy)=>{
      el.style.left=dx; 
      el.style.top=dy; 
      drawSnap(el);
    }, ()=>{
      clearSnap(); 
      saveLayout();
    });
  };
  el.oninput = ()=>saveLayout();
}
 
function startDrag(e, moveFn, endFn) {
  const rect = canvas.getBoundingClientRect();
  const canvasWidth = parseInt(canvas.style.width);
  const canvasHeight = parseInt(canvas.style.height);
  
  const sx = e.clientX - rect.left - parseInt(e.target.style.left);
  const sy = e.clientY - rect.top - parseInt(e.target.style.top);
  
  function onMove(ev) {
    let x = (ev.clientX - rect.left - sx);
    let y = (ev.clientY - rect.top - sy);
    
    // Constrain to canvas boundaries
    const elWidth = e.target.offsetWidth;
    const elHeight = e.target.offsetHeight;
    
    x = Math.max(0, Math.min(x, canvasWidth - elWidth));
    y = Math.max(0, Math.min(y, canvasHeight - elHeight));
    
    moveFn(`${x}px`, `${y}px`);
  }
  
  function onUp() { 
    document.removeEventListener('mousemove', onMove); 
    document.removeEventListener('mouseup', onUp); 
    endFn(); 
  }
  
  document.addEventListener('mousemove', onMove); 
  document.addEventListener('mouseup', onUp);
}

  function makeResizable(box, handle) {
  handle.onmousedown = e => {
    e.stopPropagation();
    const canvasWidth = parseInt(canvas.style.width);
    const canvasHeight = parseInt(canvas.style.height);
    
    const maxWidth = canvasWidth - box.offsetLeft;
    const maxHeight = canvasHeight - box.offsetTop;
    
    const sw = box.offsetWidth, sh = box.offsetHeight, sx = e.clientX, sy = e.clientY;
    
    function onMove(ev) {
      const newWidth = Math.min(maxWidth, sw + (ev.clientX - sx));
      const newHeight = Math.min(maxHeight, sh + (ev.clientY - sy));
      
      // Minimum size constraints
      if (newWidth >= 40 && newHeight >= 20) {
        box.style.width = `${newWidth}px`;
        box.style.height = `${newHeight}px`;
      }
    }
    
    function onUp() { 
      document.removeEventListener('mousemove', onMove); 
      document.removeEventListener('mouseup', onUp); 
      saveLayout(); 
    }
    
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  };
}

    function zoomIn(){ zoomLevel+=0.1; applyZoom(); }
    function zoomOut(){ zoomLevel=Math.max(0.2,zoomLevel-0.1); applyZoom(); }
    function resetZoom(){ zoomLevel=1; applyZoom(); }
    function applyZoom(){ canvas.style.transform=`scale(${zoomLevel})`; }

    function drawSnap(el) {
  if (!guideSettings.enabled) return;
  
  clearSnap();
  const others = [...document.querySelectorAll('.label-box')].filter(b => b !== el);
  const r1 = el.getBoundingClientRect();
  const cr = canvas.getBoundingClientRect();
  const distanceValue = document.getElementById('distanceValue');
  
  // Standard alignment guides
  others.forEach(o => {
    const r2 = o.getBoundingClientRect();
    if(Math.abs(r1.left - r2.left) < 8) { 
      yGuide.style.left = `${r2.left - cr.left}px`; 
      yGuide.style.display = 'block'; 
    }
    if(Math.abs(r1.top - r2.top) < 8) { 
      xGuide.style.top = `${r2.top - cr.top}px`; 
      xGuide.style.display = 'block'; 
    }
  });

  // Enhanced centering indicators for lines
  if (el.classList.contains('line-element')) {
    const canvasWidth = parseInt(canvas.style.width);
    const lineWidth = parseInt(el.style.width);
    const lineLeft = parseInt(el.style.left);
    const lineRight = lineLeft + lineWidth;
    
    const leftSpace = lineLeft;
    const rightSpace = canvasWidth - lineRight;
    const isCentered = Math.abs(leftSpace - rightSpace) < 5;
    
    if (isCentered) {
      // Create or get left and right margin indicators
      let leftIndicator = el.querySelector('.margin-indicator.left-margin');
      let rightIndicator = el.querySelector('.margin-indicator.right-margin');
      
      if (!leftIndicator) {
        leftIndicator = document.createElement('div');
        leftIndicator.className = 'margin-indicator left-margin';
        el.appendChild(leftIndicator);
      }
      
      if (!rightIndicator) {
        rightIndicator = document.createElement('div');
        rightIndicator.className = 'margin-indicator right-margin';
        el.appendChild(rightIndicator);
      }
      
      // Position and show the indicators
      leftIndicator.style.left = '0';
      leftIndicator.style.top = '50%';
      leftIndicator.style.transform = 'translate(-50%, -50%)';
      leftIndicator.style.display = 'block';
      
      rightIndicator.style.right = '0';
      rightIndicator.style.top = '50%';
      rightIndicator.style.transform = 'translate(50%, -50%)';
      rightIndicator.style.display = 'block';
      
      // Add pulsing animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes pulse {
          0% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.8); }
          50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
          100% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.8); }
        }
        .margin-indicator {
          width: 12px;
          height: 12px;
          background: #e74c3c;
          border-radius: 50%;
          position: absolute;
          z-index: 1000;
          animation: pulse 1.5s infinite;
          box-shadow: 0 0 10px rgba(231, 76, 60, 0.8);
        }
        .margin-indicator.right-margin {
          animation-name: pulse-right;
        }
        @keyframes pulse-right {
          0% { opacity: 0.3; transform: translate(50%, -50%) scale(0.8); }
          50% { opacity: 1; transform: translate(50%, -50%) scale(1.2); }
          100% { opacity: 0.3; transform: translate(50%, -50%) scale(0.8); }
        }
      `;
      document.head.appendChild(style);
    }
  }

  // New improved distance guides
  if (guideSettings.distanceEnabled && others.length >= 2) {
    // Get all element positions
    const positions = others.map(o => {
      const r = o.getBoundingClientRect();
      return { left: r.left, top: r.top, right: r.right, bottom: r.bottom };
    });

    // Check horizontal spacing patterns
    const sortedX = [...positions].sort((a, b) => a.left - b.left);
    const xSpacings = [];
    
    // Calculate all horizontal spacings between elements
    for (let i = 1; i < sortedX.length; i++) {
      const spacing = sortedX[i].left - sortedX[i-1].left;
      if (spacing >= guideSettings.minSpacing) {
        xSpacings.push(spacing);
      }
    }

    // Check if current element matches any existing horizontal spacing
    xSpacings.forEach(spacing => {
      // Check left side
      positions.forEach(pos => {
        const targetLeft = pos.left - spacing;
        if (Math.abs(r1.left - targetLeft) < 8) {
          yDistanceGuide.style.left = `${targetLeft - cr.left}px`;
          yDistanceGuide.style.display = 'block';
          showDistanceValue(spacing, targetLeft - cr.left, r1.top - cr.top);
        }
      });

      // Check right side
      positions.forEach(pos => {
        const targetLeft = pos.left + spacing;
        if (Math.abs(r1.left - targetLeft) < 8) {
          yDistanceGuide.style.left = `${targetLeft - cr.left}px`;
          yDistanceGuide.style.display = 'block';
          showDistanceValue(spacing, targetLeft - cr.left, r1.top - cr.top);
        }
      });
    });

    // Check vertical spacing patterns
    const sortedY = [...positions].sort((a, b) => a.top - b.top);
    const ySpacings = [];
    
    // Calculate all vertical spacings between elements
    for (let i = 1; i < sortedY.length; i++) {
      const spacing = sortedY[i].top - sortedY[i-1].top;
      if (spacing >= guideSettings.minSpacing) {
        ySpacings.push(spacing);
      }
    }

    // Check if current element matches any existing vertical spacing
    ySpacings.forEach(spacing => {
      // Check top side
      positions.forEach(pos => {
        const targetTop = pos.top - spacing;
        if (Math.abs(r1.top - targetTop) < 8) {
          xDistanceGuide.style.top = `${targetTop - cr.top}px`;
          xDistanceGuide.style.display = 'block';
          showDistanceValue(spacing, r1.left - cr.left, targetTop - cr.top);
        }
      });

      // Check bottom side
      positions.forEach(pos => {
        const targetTop = pos.top + spacing;
        if (Math.abs(r1.top - targetTop) < 8) {
          xDistanceGuide.style.top = `${targetTop - cr.top}px`;
          xDistanceGuide.style.display = 'block';
          showDistanceValue(spacing, r1.left - cr.left, targetTop - cr.top);
        }
      });
    });
  }
}

function showDistanceValue(distance, x, y) {
  const distanceValue = document.getElementById('distanceValue');
  distanceValue.textContent = `${Math.round(distance)}px`;
  distanceValue.style.left = `${x + 10}px`;
  distanceValue.style.top = `${y + 10}px`;
  distanceValue.style.display = 'block';
}

function clearSnap() {
  xGuide.style.display = yGuide.style.display = 'none';
  xDistanceGuide.style.display = yDistanceGuide.style.display = 'none';
  document.getElementById('distanceValue').style.display = 'none';

  // Clear all margin indicators
  document.querySelectorAll('.margin-indicator, .equal-margin-indicator').forEach(ind => {
    ind.style.display = 'none';
  });
}


    

    function saveLayout(){
      localStorage.setItem('builderLayout', JSON.stringify(getLayoutData()));
    }
 function getLayoutData(){
  return [...document.querySelectorAll('.label-box')].map(b=>({
    text: b.innerText  || (b.classList.contains('line-element') ? "Line" : ""),
    x: parseInt(b.style.left),
    y: parseInt(b.style.top),
    width: parseInt(b.style.width),
    height: parseInt(b.style.height),
    isLine: b.classList.contains('line-element'),
    fontSize: b.style.fontSize,
    fontColor: b.style.color,
    fontFamily: b.style.fontFamily,
    fontWeight: b.style.fontWeight,
    fontStyle: b.style.fontStyle,
    textDecoration: b.style.textDecoration,
    textAlign: b.style.textAlign,
    isSignature: b.getAttribute('data-signature') === 'true',
    displayText: b.getAttribute('data-display-text') || ''
  }));
}

function loadLayout(){
  const data = JSON.parse(localStorage.getItem('builderLayout')||'[]');
  data.forEach(item=>{
    createLabel(item.isLine ? "Line" : item.text, item.x, item.y);
    const b = document.querySelectorAll('.label-box').pop();

       if (item.isLine) {
      b.style.width = `${item.width}px`;
      b.style.height = `${item.height}px`;
    }
    Object.assign(b.style,{
      fontSize: item.fontSize,
      fontFamily: item.fontFamily,
      color: item.fontColor,
      fontWeight: item.fontWeight,
      fontStyle: item.fontStyle,
      textDecoration: item.textDecoration,
      textAlign: item.textAlign
    });
    
    if (item.isSignature) {
      b.setAttribute('data-signature', 'true');
      b.setAttribute('data-display-text', item.displayText);
      b.contentEditable = false;
    }
  });
}

    document.getElementById('canvasContainer').addEventListener('mousedown',e => {
      if(!e.target.classList.contains('label-box') && !e.target.classList.contains('resizer')){
        document.querySelectorAll('.label-box').forEach(b=>{
          b.classList.remove('selected');
          b.querySelector('.resizer').style.display='none';
        });
        selectedElement=null;
      }
    });

  </script>
</body>
</html>


